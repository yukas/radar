require "spec_helper"

RSpec.describe "Finds all ships" do
  subject(:scanner) { Radar::MultipleShipScanner.new([ship1, ship2], radar_frame, noisiness) }

  let(:ship1) do
    Radar::Ship.new(
      "---oo---",
      "--oooo--",
      "-oooooo-",
      "oo-oo-oo",
      "oooooooo",
      "--o--o--",
      "-o-oo-o-",
      "o-o--o-o",
    )
  end

  let(:ship2) do
    Radar::Ship.new(
      "--o-----o--",
      "---o---o---",
      "--ooooooo--",
      "-oo-ooo-oo-",
      "ooooooooooo",
      "o-ooooooo-o",
      "o-o-----o-o",
      "---oo-oo---",
    )
  end

  let(:radar_frame) do
    Radar::RadarFrame.new(
      "----o--oo----o--ooo--ooo--o------o---oo-o----oo---o--o---------o----o------o-------------o--o--o--o-",
      "--o-o-----oooooooo-oooooo---o---o----o------ooo-o---o--o----o------o--o---ooo-----o--oo-o------o----",
      "--o--------oo-ooo-oo-oo-oo-----o------------ooooo-----oo----o------o---o--o--o-o-o------o----o-o-o--",
      "-------o--oooooo--o-oo-o--o-o-----oo--o-o-oo--o-oo-oo-o--------o-----o------o-ooooo---o--o--o-------",
      "------o---o-ooo-ooo----o-----oo-------o---oo-ooooo-o------o----o--------o-oo--ooo-oo-------------o-o",
      "-o--o-----o-o---o-ooooo-o-------oo---o---------o-----o-oo-----------oo----ooooooo-ooo-oo------------",
      "o-------------ooooo-o--o--o--o-------o--o-oo-oo-o-o-o----oo------------o--oooo--ooo-o----o-----o--o-",
      "--o-------------------------oo---------oo-o-o--ooo----oo----o--o--o----o--o-o-----o-o------o-o------",
      "-------------------o----------o------o--o------o--------o--------o--oo-o-----oo-oo---o--o---o-----oo",
      "----------o----------o---o--------------o--o----o--o-o------------oo------o--o-o---o-----o----------",
      "------o----o-o---o-----o-o---o-----oo-o--------o---------------------------------o-o-o--o-----------",
      "---------------o-------o-----o-------o-------------------o-----o---------o-o-------------o-------oo-",
      "-o--o-------------o-o-----o--o--o--oo-------------o----ooo----o-------------o----------oo----o---o-o",
      "-o--o-------------o----oo------o--o-------o--o-----o-----o----o-----o--o----o--oo-----------o-------",
      "-o-----oo-------o------o----o----------o--o----o-----o-----o-------o-----------o---o-o--oooooo-----o",
      "-o--------o-----o-----o---------oo----oo---o-o---------o---o--oooo-oo--o-------o------oo--oo--o-----",
      "------------o---------o---------o----oooo-------------oo-oo-----ooo-oo-----o-------o-oo-oooooooo---o",
      "----------------------o------------oooooooo---o-----o-------o--oooooo-o------------o-o-ooooooo-o----",
      "------------o------o---o---o-------oo-oo--o--o---------o--o-o-o-ooooo-o--------------oo-o----o-oo-o-",
      "---o-o----------oo-------oo----o----oooooooo-------o----o-o-o-o-----o-o-----o----------ooo-oo--o---o",
      "-o-o---------o-o---------------o--o--o--ooo---ooo-------o------oo-oo------------o--------o--o-o--o--",
      "-------oo---------------------------o-oo----------o------o-o-------o-----o----o-----o-oo-o-----o---o",
      "---o--------o-----o-------o-oo-----oo--oo-o----oo----------o--o---oo------oo----o-----o-------o-----",
      "---o--ooo-o---------o-o----o------------o---------o----o--o-------o----o--------o----------------oo-",
      "---o------o----------------o----o------o------o---oo-----------o-------------o----------oo---------o",
      "--oo---------------o--o------o---o-----o--o-------------o------o-------o-----o-----o----o------o--o-",
      "-o-------o----------o-o-o-------o-----o--o-o-----------o-oo-----------o------o---------o-----o-o----",
      "----------o----o-------o----o--o------o------------o---o---------------oo----o-----ooo--------------",
      "----o--------oo----o-o----o--o------ooo----o-oooo---o--o-oo--------o-oo-----o-o---o-o--o-----oo-----",
      "------o--------o-ooooo----o---o--o-----o---------------o-o-------o-----o----------------------------",
      "o-------oo----o--oooooo-o---o--o------oooo----------o-oo-------o---o----------o------oo-------------",
      "-o---o----------o--oo-oo-o---o-----o-o-----------------------oo--o------o------o--------------------",
      "-----oo-o-o-o---ooooooooo----o----o--------o--o---oo---o------------o----------o-o---o------o-o--oo-",
      "------o------o---ooo-o---------------------------o--o---o---o----o--o-------o-----o------o----o----o",
      "-------o----------ooo-o-----o----o---o--o-oo--o--o-o--o------o--o-oo---ooo------------------------o-",
      "-o-------o------o-o--ooo--o---o---oo-----o----o-------------o----o-ooo-o------o--o-o------o-o-------",
      "---oo--o---o-o---------o---o--------------o--o-----o-------o-----o--o---o-oo--------o----o----o-----",
      "o------o----oo-o-----------oo--o---o--------o-o------o-------o-o------o-oo---------o-----oo---------",
      "----o--o---o-o-----------o---o------------o-------o----o--o--o--o-o---------------o-----------------",
      "-------oo--o-o-----o-----o----o-o--o----------------------o-------o------o----oo----ooo---------o---",
      "o-----oo-------------------o--o-----o-----------o------o-------o----o-----------o----------------o--",
      "--o---o-------o------------o--------------------o----o--o-------------oo---o---------oo--------o----",
      "--o--------o---------o------------o------o-------o------------o-------o---o---------ooooo-----------",
      "------o--------------o-o-o---------o---o-------o--o-----o-------o-o----------o-----oo-ooo----------o",
      "--o---------------o----o--oo-------------o---------o-------------------oo---------oo-o-ooo----------",
      "-o-----------o------ooo----o----------------ooo-----o--------o--o---o-----------o-o-oooooo--------oo",
      "-o---o-------o---o-oooo-----o-------------------o----oo-----------------o--o--------o--o------o--o--",
      "-------o---o------oooooo--o----ooo--o--------o-------o----------------------------oo-oo-o--o--------",
      "o--oo------o-----oo--o-oo------------oo--o------o--o-------------oo----o------------oooo-o------oo--",
      "-----o----------ooooooooo--------------oo--------------oo-----o-----o-o--o------o----------o----o---"
    )
  end

  context "with 10% noisiness" do
    let(:noisiness) { 10 }

    it "finds 1 ship" do
      scanner.scan

      expect(radar_frame.line).to eq(
        "----o--oo----o--ooo--ooo--o------o---oo-o----oo---o--o---------o----o------o-------------o--o--o--o-" \
        "--o-o-----oooooooo-oooooo---o---o----o------ooo-o---o--o----o------o--o---ooo-----o--oo-o------o----" \
        "--o--------oo-ooo-oo-oo-oo-----o------------ooooo-----oo----o------o---o--o--o-o-o------o----o-o-o--" \
        "-------o--oooooo--o-oo-o--o-o-----oo--o-o-oo--o-oo-oo-o--------o-----o------o-ooooo---o--o--o-------" \
        "------o---o-ooo-ooo----o-----oo-------o---oo-ooooo-o------o----o--------o-oo--ooo-oo-------------o-o" \
        "-o--o-----o-o---o-ooooo-o-------oo---o---------o-----o-oo-----------oo----ooooooo-ooo-oo------------" \
        "o-------------ooooo-o--o--o--o-------o--o-oo-oo-o-o-o----oo------------o--oooo--ooo-o----o-----o--o-" \
        "--o-------------------------oo---------oo-o-o--ooo----oo----o--o--o----o--o-o-----o-o------o-o------" \
        "-------------------o----------o------o--o------o--------o--------o--oo-o-----oo-oo---o--o---o-----oo" \
        "----------o----------o---o--------------o--o----o--o-o------------oo------o--o-o---o-----o----------" \
        "------o----o-o---o-----o-o---o-----oo-o--------o---------------------------------o-o-o--o-----------" \
        "---------------o-------o-----o-------o-------------------o-----o---------o-o-------------o-------oo-" \
        "-o--o-------------o-o-----o--o--o--oo-------------o----ooo----o-------------o----------oo----o---o-o" \
        "-o--o-------------o----oo------o--o-------o--o-----o-----o--xxxxxxxxxxxo----o--oo-----------o-------" \
        "-o-----oo-------o------o----o----------o--o----o-----o-----oxxxxxxxxxxx--------o---o-o--oooooo-----o" \
        "-o--------o-----o-----o---------oo----oo---o-o---------o---oxxxxxxxxxxxo-------o------oo--oo--o-----" \
        "------------o---------o---------o----oooo-------------oo-oo-xxxxxxxxxxx----o-------o-oo-oooooooo---o" \
        "----------------------o------------oooooooo---o-----o-------xxxxxxxxxxx------------o-o-ooooooo-o----" \
        "------------o------o---o---o-------oo-oo--o--o---------o--o-xxxxxxxxxxx--------------oo-o----o-oo-o-" \
        "---o-o----------oo-------oo----o----oooooooo-------o----o-o-xxxxxxxxxxx-----o----------ooo-oo--o---o" \
        "-o-o---------o-o---------------o--o--o--ooo---ooo-------o---xxxxxxxxxxx---------o--------o--o-o--o--" \
        "-------oo---------------------------o-oo----------o------o-o-------o-----o----o-----o-oo-o-----o---o" \
        "---o--------o-----o-------o-oo-----oo--oo-o----oo----------o--o---oo------oo----o-----o-------o-----" \
        "---o--ooo-o---------o-o----o------------o---------o----o--o-------o----o--------o----------------oo-" \
        "---o------o----------------o----o------o------o---oo-----------o-------------o----------oo---------o" \
        "--oo---------------o--o------o---o-----o--o-------------o------o-------o-----o-----o----o------o--o-" \
        "-o-------o----------o-o-o-------o-----o--o-o-----------o-oo-----------o------o---------o-----o-o----" \
        "----------o----o-------o----o--o------o------------o---o---------------oo----o-----ooo--------------" \
        "----o--------oo----o-o----o--o------ooo----o-oooo---o--o-oo--------o-oo-----o-o---o-o--o-----oo-----" \
        "------o--------o-ooooo----o---o--o-----o---------------o-o-------o-----o----------------------------" \
        "o-------oo----o--oooooo-o---o--o------oooo----------o-oo-------o---o----------o------oo-------------" \
        "-o---o----------o--oo-oo-o---o-----o-o-----------------------oo--o------o------o--------------------" \
        "-----oo-o-o-o---ooooooooo----o----o--------o--o---oo---o------------o----------o-o---o------o-o--oo-" \
        "------o------o---ooo-o---------------------------o--o---o---o----o--o-------o-----o------o----o----o" \
        "-------o----------ooo-o-----o----o---o--o-oo--o--o-o--o------o--o-oo---ooo------------------------o-" \
        "-o-------o------o-o--ooo--o---o---oo-----o----o-------------o----o-ooo-o------o--o-o------o-o-------" \
        "---oo--o---o-o---------o---o--------------o--o-----o-------o-----o--o---o-oo--------o----o----o-----" \
        "o------o----oo-o-----------oo--o---o--------o-o------o-------o-o------o-oo---------o-----oo---------" \
        "----o--o---o-o-----------o---o------------o-------o----o--o--o--o-o---------------o-----------------" \
        "-------oo--o-o-----o-----o----o-o--o----------------------o-------o------o----oo----ooo---------o---" \
        "o-----oo-------------------o--o-----o-----------o------o-------o----o-----------o----------------o--" \
        "--o---o-------o------------o--------------------o----o--o-------------oo---o---------oo--------o----" \
        "--o--------o---------o------------o------o-------o------------o-------o---o---------ooooo-----------" \
        "------o--------------o-o-o---------o---o-------o--o-----o-------o-o----------o-----oo-ooo----------o" \
        "--o---------------o----o--oo-------------o---------o-------------------oo---------oo-o-ooo----------" \
        "-o-----------o------ooo----o----------------ooo-----o--------o--o---o-----------o-o-oooooo--------oo" \
        "-o---o-------o---o-oooo-----o-------------------o----oo-----------------o--o--------o--o------o--o--" \
        "-------o---o------oooooo--o----ooo--o--------o-------o----------------------------oo-oo-o--o--------" \
        "o--oo------o-----oo--o-oo------------oo--o------o--o-------------oo----o------------oooo-o------oo--" \
        "-----o----------ooooooooo--------------oo--------------oo-----o-----o-o--o------o----------o----o---"
      )
    end
  end

  context "with 25% noisiness" do
    let(:noisiness) { 25 }

    it "finds 9 ships" do
      scanner.scan

      expect(radar_frame.line).to eq(
        "----o--ooxxxxxxxxxxx-ooo--o------o---oo-xxxxxxxx--o--o---------o----o------o-------------o--o--o--o-" \
        "--o-o----xxxxxxxxxxxooooo---o---o----o--xxxxxxxxo---o--o----o------o--oxxxxxxxxxxxo--oo-o------o----" \
        "--o------xxxxxxxxxxx-oo-oo-----o--------xxxxxxxxo-----oo----o------o---xxxxxxxxxxx------o----o-o-o--" \
        "-------o-xxxxxxxxxxxoo-o--o-o-----oo--o-xxxxxxxxoo-oo-o--------o-----o-xxxxxxxxxxxo---o--o--o-------" \
        "------o--xxxxxxxxxxx---o-----oo-------o-xxxxxxxxoo-o------o----o-------xxxxxxxxxxxoo-------------o-o" \
        "-o--o----xxxxxxxxxxxooo-o-------oo---o--xxxxxxxx-----o-oo-----------oo-xxxxxxxxxxxooo-oo------------" \
        "o--------xxxxxxxxxxxo--o--o--o-------o--xxxxxxxxo-o-o----oo------------xxxxxxxxxxxo-o----o-----o--o-" \
        "--o-------------------------oo---------oxxxxxxxxoo----oo----o--o--o----xxxxxxxxxxxo-o------o-o------" \
        "-------------------o----------o------o--o------o--------o--------o--oo-xxxxxxxxxxx---o--o---o-----oo" \
        "----------o----------o---o--------------o--o----o--o-o------------oo------o--o-o---o-----o----------" \
        "------o----o-o---o-----o-o---o-----oo-o--------o---------------------------------o-o-o--o-----------" \
        "---------------o-------o-----o-------o-------------------o-----o---------o-o-------------o-------oo-" \
        "-o--o-------------o-o-----o--o--o--oo-------------o----ooo----o-------------o------xxxxxxxxxxx---o-o" \
        "-o--o-------------o----oo------o--o-------o--o-----o-----oxxxxxxxxxxx--o----o--oo--xxxxxxxxxxx------" \
        "-o-----oo-------o------o----o----------o--o----o-----o----xxxxxxxxxxx----------o---xxxxxxxxxxx-----o" \
        "-o--------o-----o-----o---------oo--xxxxxxxxxxx--------o--xxxxxxxxxxx--o-------o---xxxxxxxxxxxo-----" \
        "------------o---------o---------o---xxxxxxxxxxx-------oo-oxxxxxxxxxxxo-----o-------xxxxxxxxxxxoo---o" \
        "----------------------o------------oxxxxxxxxxxx-----o-----xxxxxxxxxxx-o------------xxxxxxxxxxx-o----" \
        "------------o------o---o---o-------oxxxxxxxxxxx--------o--xxxxxxxxxxx-o------------xxxxxxxxxxx-oo-o-" \
        "---o-o----------oo-------oo----o----xxxxxxxxxxx----o----o-xxxxxxxxxxx-o-----o------xxxxxxxxxxx-o---o" \
        "-o-o---------o-o---------------o--o-xxxxxxxxxxxoo-------o-xxxxxxxxxxx-----------o--------o--o-o--o--" \
        "-------oo---------------------------xxxxxxxxxxx---o------o-o-------o-----o----o-----o-oo-o-----o---o" \
        "---o--------o-----o-------o-oo-----oxxxxxxxxxxxoo----------o--o---oo------oo----o-----o-------o-----" \
        "---o--ooo-o---------o-o----o------------o---------o----o--o-------o----o--------o----------------oo-" \
        "---o------o----------------o----o------o------o---oo-----------o-------------o----------oo---------o" \
        "--oo---------------o--o------o---o-----o--o-------------o------o-------o-----o-----o----o------o--o-" \
        "-o-------o----------o-o-o-------o-----o--o-o-----------o-oo-----------o------o---------o-----o-o----" \
        "----------o----o---xxxxxxxx-o--o------o------------o---o---------------oo----o-----ooo--------------" \
        "----o--------oo----xxxxxxxx--o------ooo----o-oooo---o--o-oo--------o-oo-----o-o---o-o--o-----oo-----" \
        "------o--------o-ooxxxxxxxx---o--o-----o---------------o-o-------o-----o----------------------------" \
        "o-------oo----o--ooxxxxxxxx-o--o------oooo----------o-oo-------o---o----------o------oo-------------" \
        "-o---o----------o--xxxxxxxx--o-----o-o-----------------------oo--o------o------o--------------------" \
        "-----oo-o-o-o---oooxxxxxxxx--o----o--------o--o---oo---o------------o----------o-o---o------o-o--oo-" \
        "------o------o---ooxxxxxxxx----------------------o--o---o---o----o--o-------o-----o------o----o----o" \
        "-------o----------oxxxxxxxx-o----o---o--o-oo--o--o-o--o------o--o-oo---ooo------------------------o-" \
        "-o-------o------o-o--ooo--o---o---oo-----o----o-------------o----o-ooo-o------o--o-o------o-o-------" \
        "---oo--o---o-o---------o---o--------------o--o-----o-------o-----o--o---o-oo--------o----o----o-----" \
        "o------o----oo-o-----------oo--o---o--------o-o------o-------o-o------o-oo---------o-----oo---------" \
        "----o--o---o-o-----------o---o------------o-------o----o--o--o--o-o---------------o-----------------" \
        "-------oo--o-o-----o-----o----o-o--o----------------------o-------o------o----oo----ooo---------o---" \
        "o-----oo-------------------o--o-----o-----------o------o-------o----o----------xxxxxxxxxxx-------o--" \
        "--o---o-------o------------o--------------------o----o--o-------------oo---o---xxxxxxxxxxx-----o----" \
        "--o--------o---------o------------o------o-------o------------o-------o---o----xxxxxxxxxxx----------" \
        "------o--------------o-o-o---------o---o-------o--o-----o-------o-o----------o-xxxxxxxxxxx---------o" \
        "--o---------------o----o--oo-------------o---------o-------------------oo------xxxxxxxxxxx----------" \
        "-o-----------o------ooo----o----------------ooo-----o--------o--o---o----------xxxxxxxxxxx--------oo" \
        "-o---o-------oxxxxxxxxo-----o-------------------o----oo-----------------o--o---xxxxxxxxxxx----o--o--" \
        "-------o---o--xxxxxxxxoo--o----ooo--o--------o-------o-------------------------xxxxxxxxxxx-o--------" \
        "o--oo------o--xxxxxxxx-oo------------oo--o------o--o-------------oo----o------------oooo-o------oo--" \
        "-----o--------xxxxxxxxooo--------------oo--------------oo-----o-----o-o--o------o----------o----o---"
      )
    end
  end
end
